import{u as ne,r,j as e,s as p}from"./index-Hl5FDKDL.js";import{a as ie,v as le,b as ce,f as W}from"./validation-C4eTZtKi.js";function he(){const c=ne(),[d,f]=r.useState(1),[o,w]=r.useState(""),[u,L]=r.useState(!1),[v,K]=r.useState(""),[h,J]=r.useState(""),[y,Y]=r.useState(""),[A,Q]=r.useState(!1),[O,X]=r.useState(!1),[E,Z]=r.useState(!1),[D,S]=r.useState(""),[R,T]=r.useState(""),[C,n]=r.useState(""),[g,P]=r.useState(["","","","","",""]),[j,B]=r.useState(60),[$,G]=r.useState(!1),[N,U]=r.useState(!1),[ee,M]=r.useState(0),[F,q]=r.useState(!1),k=r.useRef(null);r.useEffect(()=>{const t=async()=>{console.log("Checking for OAuth callback...",{hash:window.location.hash,search:window.location.search,pathname:window.location.pathname});const s=new URLSearchParams(window.location.hash.substring(1)),a=s.has("access_token"),i=s.has("refresh_token"),m=new URLSearchParams(window.location.search).get("role"),H=localStorage.getItem("pending_oauth_role"),l=m||H;if(console.log("OAuth detection:",{hasAccessToken:a,hasRefreshToken:i,urlRole:m,pendingRole:H,detectedRole:l}),(a||i||l&&d===1)&&l){console.log("Processing OAuth callback for role:",l);try{await new Promise(I=>setTimeout(I,500));const{data:{session:x},error:V}=await p.auth.getSession();if(console.log("Session check:",{hasSession:!!x,error:V}),V){console.error("OAuth session error:",V),n("Authentication failed. Please try again."),localStorage.removeItem("pending_oauth_role"),window.history.replaceState({},document.title,"/signup");return}if(x?.user){console.log("User authenticated, updating profile..."),await p.auth.updateUser({data:{role:l}});const{error:I}=await p.from("users").upsert({id:x.user.id,email:x.user.email,full_name:x.user.user_metadata?.full_name||x.user.user_metadata?.name,role:l,updated_at:new Date().toISOString()},{onConflict:"id"});I&&console.error("Error saving user to database:",I),localStorage.removeItem("pending_oauth_role"),window.history.replaceState({},document.title,window.location.pathname),console.log("Redirecting to dashboard for role:",l),l==="facility"?c("/facility-dashboard",{replace:!0}):l==="physician"||l==="crna"||l==="vendor"?c("/physician-dashboard",{replace:!0}):c("/profile-completion",{replace:!0})}else console.log("No session found yet, will retry..."),n("Please wait while we complete your sign in..."),setTimeout(t,1e3)}catch(x){console.error("OAuth processing error:",x),n("Authentication failed. Please try again."),localStorage.removeItem("pending_oauth_role"),window.history.replaceState({},document.title,"/signup")}}};t()},[c,d]);const te=async()=>{if(!o){n("Please select a role first");return}q(!0),n("");try{localStorage.setItem("pending_oauth_role",o),console.log("Starting Google OAuth for role:",o);const{error:t}=await p.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/signup?role=${o}`,queryParams:{access_type:"offline",prompt:"consent"}}});if(t)throw t}catch(t){console.error("Google OAuth error:",t),n(t.message||"Failed to sign in with Google. Please try again."),q(!1),localStorage.removeItem("pending_oauth_role")}},z=async()=>{if(n(""),S(""),T(""),u){const s=ie(h);if(!s.valid){S(s.error||"Invalid phone number");return}}else{const s=le(h);if(!s.valid){S(s.error||"Invalid email address. Please include @ and a valid domain.");return}}const t=ce(y);if(!t.valid){T(t.error||"Invalid password");return}U(!0);try{if(k.current={fullName:v,role:o,contact:h,password:y,usePhone:u},u){const s=W(h),{error:a}=await p.auth.signUp({phone:s,password:y,options:{data:{full_name:v,role:o}}});if(a)throw a.message?.toLowerCase().includes("phone")&&(a.message?.toLowerCase().includes("disabled")||a.message?.toLowerCase().includes("not enabled"))?new Error("Phone authentication is not yet enabled. Please use email signup or contact support."):a}else{const{error:s}=await p.auth.signUp({email:h,password:y,options:{emailRedirectTo:void 0,data:{full_name:v,role:o}}});if(s)throw s}f(3),B(60),P(["","","","","",""]),M(0)}catch(s){s.message?.includes("already registered")?n("This email is already registered. Please log in instead."):s.message?.includes("rate limit")?n("Too many requests. Please wait a moment before trying again."):n(s.message||"Failed to send verification code. Please try again.")}finally{U(!1)}};r.useEffect(()=>{if(d!==3||j===0)return;const t=setTimeout(()=>B(s=>s-1),1e3);return()=>clearTimeout(t)},[j,d]);const se=(t,s)=>{if(!/^\d?$/.test(s))return;const a=[...g];a[t]=s,P(a),s&&t<5&&document.getElementById(`otp-${t+1}`)?.focus()},ae=(t,s)=>{s.key==="Backspace"&&!g[t]&&t>0&&document.getElementById(`otp-${t-1}`)?.focus()},re=t=>{t.preventDefault();const s=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(s.length>0){const a=[...g];for(let m=0;m<6;m++)a[m]=s[m]||"";P(a);const i=Math.min(s.length,5);document.getElementById(`otp-${i}`)?.focus()}},oe=async()=>{if(g.some(t=>t==="")){n("Please enter the complete 6-digit code.");return}G(!0),n("");try{const t=g.join(""),s=k.current;if(!s)throw new Error("Session expired. Please start over.");if(u){const a=W(s.contact),{data:i,error:b}=await p.auth.verifyOtp({phone:a,token:t,type:"sms"});if(b)throw b;if(i.user){const{error:m}=await p.from("users").upsert({id:i.user.id,phone:a,full_name:s.fullName,role:s.role,phone_verified:!0,profile_complete:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"id"});m&&console.error("Error saving user to database:",m)}}else{const{data:a,error:i}=await p.auth.verifyOtp({email:s.contact,token:t,type:"signup"});if(i)throw i;if(a.user){const{error:b}=await p.from("users").upsert({id:a.user.id,email:s.contact,full_name:s.fullName,role:s.role,email_verified:!0,profile_complete:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"id"});b&&console.error("Error saving user to database:",b)}}k.current=null,f(4)}catch(t){M(s=>s+1),ee>=2?n("Too many incorrect attempts. Please request a new code."):t.message?.includes("expired")?n("Verification code has expired. Please request a new code."):t.message?.includes("Invalid")||t.message?.includes("invalid")?n("Invalid verification code. Please check the code and try again."):n(t.message||"Verification failed. Please try again."),P(["","","","","",""])}finally{G(!1)}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4 py-8",children:e.jsxs("div",{className:"w-full max-w-md bg-white rounded-xl shadow-lg p-6",children:[d===1&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4 text-center",children:"Who are you?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(_,{value:"physician",label:"Physician",description:"Licensed medical doctor",role:o,setRole:w}),e.jsx(_,{value:"crna",label:"CRNA / Advanced Provider",description:"Certified Registered Nurse Anesthetist",role:o,setRole:w}),e.jsx(_,{value:"facility",label:"Facility",description:"Hospital or clinic",role:o,setRole:w}),e.jsx(_,{value:"vendor",label:"Third-Party Vendor",description:"Service provider",role:o,setRole:w})]}),e.jsx("button",{type:"button",onClick:()=>f(2),disabled:!o,className:`mt-6 w-full py-2 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${o?"bg-teal-600 hover:bg-teal-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Continue"})]}),d===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4 text-center",children:"Create your account"}),e.jsxs("button",{type:"button",onClick:te,disabled:F,className:"w-full flex items-center justify-center gap-3 py-2.5 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:[F?e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg"}):e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{className:"font-medium text-gray-700",children:F?"Connecting...":"Continue with Google"})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white text-gray-500",children:"or sign up with email"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{type:"button",onClick:()=>L(!1),className:`px-3 py-1 rounded whitespace-nowrap cursor-pointer ${u?"bg-gray-100 text-gray-700":"bg-teal-600 text-white"}`,children:"Email"}),e.jsx("button",{type:"button",onClick:()=>L(!0),className:`px-3 py-1 rounded whitespace-nowrap cursor-pointer ${u?"bg-teal-600 text-white":"bg-gray-100 text-gray-700"}`,children:"Phone"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name / DBA"}),e.jsx("input",{type:"text",value:v,onChange:t=>K(t.target.value),placeholder:"John Doe or Acme Clinic",className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none text-sm"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:u?"Phone Number":"Email Address"}),e.jsx("input",{type:u?"tel":"email",value:h,onChange:t=>{J(t.target.value),S("")},placeholder:u?"+1 555-123-4567":"you@example.com",className:`mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none text-sm ${D?"border-red-500":"border-gray-300"}`}),D&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:D})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:A?"text":"password",value:y,onChange:t=>{Y(t.target.value),T("")},placeholder:"Create a strong password",className:`mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none text-sm ${R?"border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:()=>Q(!A),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 cursor-pointer",children:e.jsx("i",{className:A?"ri-eye-off-line":"ri-eye-line"})})]}),R&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:R}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Must be 8+ characters with uppercase, lowercase, number, and special character"})]}),e.jsxs("div",{className:"mb-4 flex items-start",children:[e.jsx("input",{type:"checkbox",id:"role-consent",checked:E,onChange:t=>Z(t.target.checked),className:"mt-1 h-4 w-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500 cursor-pointer"}),e.jsx("label",{htmlFor:"role-consent",className:"ml-2 text-sm text-gray-700 cursor-pointer",children:o?de[o]:"I accept the role-specific consent."})]}),e.jsxs("div",{className:"mb-4 flex items-start",children:[e.jsx("input",{type:"checkbox",id:"terms",checked:O,onChange:t=>X(t.target.checked),className:"mt-1 h-4 w-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500 cursor-pointer"}),e.jsxs("label",{htmlFor:"terms",className:"ml-2 text-sm text-gray-700 cursor-pointer",children:["I agree to the ",e.jsx("a",{href:"/terms",className:"text-teal-600 underline",children:"Terms of Service"})," and"," ",e.jsx("a",{href:"/privacy",className:"text-teal-600 underline",children:"Privacy Policy"}),"."]})]}),C&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:C})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{type:"button",onClick:()=>f(1),className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 whitespace-nowrap cursor-pointer",children:"← Back"}),e.jsx("button",{type:"button",onClick:z,disabled:!v.trim()||!h.trim()||!y.trim()||!E||!O||N,className:`px-4 py-2 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${v.trim()&&h.trim()&&y.trim()&&E&&O&&!N?"bg-teal-600 hover:bg-teal-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:N?e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Sending..."]}):"Send Verification Code"})]})]}),d===3&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4 text-center",children:"Enter Verification Code"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4 text-center",children:["We sent a 6-digit code to ",e.jsx("strong",{children:h})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-xs text-amber-800 text-center",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"Check your ",u?"SMS messages":"email inbox (and spam folder)"," for the 6-digit code"]})}),e.jsx("div",{className:"flex justify-center gap-2 mb-6",onPaste:re,children:g.map((t,s)=>e.jsx("input",{id:`otp-${s}`,type:"text",inputMode:"numeric",maxLength:1,value:t,onChange:a=>se(s,a.target.value),onKeyDown:a=>ae(s,a),className:"w-10 h-12 text-center border border-gray-300 rounded-lg text-xl focus:outline-none focus:ring-2 focus:ring-teal-500",autoFocus:s===0},s))}),C&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:C})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{type:"button",onClick:z,disabled:j>0||N,className:`px-3 py-1 text-sm rounded whitespace-nowrap cursor-pointer ${j===0&&!N?"bg-teal-600 text-white hover:bg-teal-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:N?"Sending...":j===0?"Resend Code":`Resend in ${j}s`}),e.jsx("button",{type:"button",onClick:oe,disabled:g.some(t=>t==="")||$,className:`px-4 py-2 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${g.every(t=>t!=="")&&!$?"bg-teal-600 hover:bg-teal-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:$?e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Verifying..."]}):"Verify & Create Account"})]}),e.jsx("button",{type:"button",onClick:()=>f(2),className:"w-full text-sm text-gray-600 hover:underline whitespace-nowrap cursor-pointer",children:"← Change contact info"})]}),d===4&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-check-line text-3xl text-teal-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Account Created!"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Your account is now active. Complete your profile to start using the platform."}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{type:"button",onClick:()=>c("/profile-completion"),className:"w-full py-2 rounded-lg bg-teal-600 text-white font-medium hover:bg-teal-700 transition-colors whitespace-nowrap cursor-pointer",children:"Complete Profile Now"}),e.jsx("button",{type:"button",onClick:()=>{const s=k.current?.role?.toLowerCase()||o;c(s==="facility"?"/facility-dashboard":"/physician-dashboard")},className:"w-full py-2 rounded-lg bg-gray-100 text-gray-800 hover:bg-gray-200 transition-colors whitespace-nowrap cursor-pointer",children:"Go to Dashboard"})]})]})})]})})}function _({value:c,label:d,description:f,role:o,setRole:w}){return e.jsxs("button",{type:"button",onClick:()=>w(c),className:`flex flex-col items-center p-4 border rounded-lg transition-colors cursor-pointer ${o===c?"border-teal-600 bg-teal-50":"border-gray-300 hover:border-teal-400"}`,children:[e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:d}),e.jsx("span",{className:"text-sm text-gray-600 mt-1 text-center",children:f})]})}const de={physician:"I acknowledge that this platform is a technology marketplace only and I will be acting as an independent physician.",crna:"I acknowledge that this platform is a technology marketplace only and I will be acting as an independent CRNA / advanced provider.",facility:"I acknowledge that this platform is a technology marketplace only and I will be representing a healthcare facility.",vendor:"I acknowledge that this platform is a technology marketplace only and I will be offering third-party services."};export{he as default};
//# sourceMappingURL=page-Ds933xeM.js.map
