{"version":3,"file":"page-CSQIeRE-.js","sources":["../../src/pages/login/page.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"../../utils/supabaseClient\";\nimport { validateEmail } from \"../../utils/validation\";\n\ntype LoginStep = \"email\" | \"otp\";\n\nexport default function LoginPage() {\n  const navigate = useNavigate();\n\n  // UI state\n  const [step, setStep] = useState<LoginStep>(\"email\");\n  const [email, setEmail] = useState<string>(\"\");\n  const [otpDigits, setOtpDigits] = useState<string[]>([\"\", \"\", \"\", \"\", \"\", \"\"]);\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\n  const [errorMsg, setErrorMsg] = useState<string>(\"\");\n  const [successMsg, setSuccessMsg] = useState<string>(\"\");\n  const [resendCooldown, setResendCooldown] = useState<number>(0);\n  const [isGoogleLoading, setIsGoogleLoading] = useState<boolean>(false);\n\n  // Handle OAuth callback redirect AND existing sessions\n  useEffect(() => {\n    const handleAuthCheck = async () => {\n      console.log('Login page: Checking for OAuth callback...', {\n        hash: window.location.hash,\n        search: window.location.search,\n        pathname: window.location.pathname\n      });\n\n      // Check if this is an OAuth callback from Supabase\n      const hashParams = new URLSearchParams(window.location.hash.substring(1));\n      const hasAccessToken = hashParams.has('access_token');\n      const hasRefreshToken = hashParams.has('refresh_token');\n      \n      console.log('Login OAuth detection:', {\n        hasAccessToken,\n        hasRefreshToken\n      });\n\n      // ALWAYS check for session (whether OAuth callback or not)\n      try {\n        // Wait a moment for Supabase to process tokens if this is OAuth callback\n        if (hasAccessToken || hasRefreshToken) {\n          await new Promise(resolve => setTimeout(resolve, 500));\n        }\n        \n        // Check for authenticated session\n        const { data: { session }, error } = await supabase.auth.getSession();\n        \n        console.log('Login session check:', { hasSession: !!session, error });\n        \n        if (error) {\n          console.error('Session error:', error);\n          return;\n        }\n\n        if (session?.user) {\n          console.log('User is authenticated, redirecting...');\n          \n          // Save user to database\n          await saveUserToDatabase(session.user);\n\n          // Get user role and redirect\n          const userRole = session.user.user_metadata?.role?.toLowerCase();\n\n          console.log('Redirecting to dashboard for role:', userRole);\n\n          // Clean up URL\n          window.history.replaceState({}, document.title, window.location.pathname);\n\n          // Redirect based on role\n          if (userRole === 'facility') {\n            navigate('/facility-dashboard', { replace: true });\n          } else if (userRole === 'physician' || userRole === 'crna' || userRole === 'vendor') {\n            navigate('/physician-dashboard', { replace: true });\n          } else {\n            // User exists but no role - send to profile completion\n            navigate('/profile-completion', { replace: true });\n          }\n        } else {\n          console.log('No active session found');\n        }\n      } catch (error: any) {\n        console.error('Auth check error:', error);\n      }\n    };\n\n    handleAuthCheck();\n  }, [navigate]);\n\n  // Cooldown timer for resend OTP\n  useEffect(() => {\n    if (resendCooldown > 0) {\n      const timer = setTimeout(() => setResendCooldown(resendCooldown - 1), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [resendCooldown]);\n\n  // Google OAuth Sign In\n  const handleGoogleSignIn = async () => {\n    setIsGoogleLoading(true);\n    setErrorMsg(\"\");\n\n    try {\n      console.log('Starting Google OAuth login...');\n      \n      const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n          redirectTo: `${window.location.origin}/login`,\n          queryParams: {\n            access_type: 'offline',\n            prompt: 'consent',\n          },\n        }\n      });\n\n      if (error) throw error;\n    } catch (error: any) {\n      console.error('Google OAuth error:', error);\n      setErrorMsg(error.message || \"Failed to sign in with Google. Please try again.\");\n      setIsGoogleLoading(false);\n    }\n  };\n\n  // Save user data to database\n  const saveUserToDatabase = async (user: any) => {\n    try {\n      const { error } = await supabase\n        .from('users')\n        .upsert({\n          id: user.id,\n          email: user.email,\n          updated_at: new Date().toISOString(),\n        }, {\n          onConflict: 'id'\n        });\n\n      if (error) {\n        console.error('Error saving user to database:', error);\n      }\n    } catch (err) {\n      console.error('Error in saveUserToDatabase:', err);\n    }\n  };\n\n  // Send OTP to email\n  const handleSendOTP = async () => {\n    setErrorMsg(\"\");\n    setSuccessMsg(\"\");\n\n    // Validate email\n    const emailValidation = validateEmail(email);\n    if (!emailValidation.valid) {\n      setErrorMsg(emailValidation.error || \"Invalid email address\");\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      // Use signInWithOtp to send a 6-digit code to email\n      const { error } = await supabase.auth.signInWithOtp({\n        email: email,\n        options: {\n          shouldCreateUser: false, // Don't create new users on login - they should sign up first\n        }\n      });\n\n      if (error) {\n        // If user doesn't exist, show helpful message\n        if (error.message?.includes('Signups not allowed') || error.message?.includes('not allowed')) {\n          throw new Error(\"No account found with this email. Please sign up first.\");\n        }\n        throw error;\n      }\n\n      // Move to OTP verification step\n      setStep(\"otp\");\n      setSuccessMsg(`A 6-digit code has been sent to ${email}`);\n      setResendCooldown(60);\n      setOtpDigits([\"\", \"\", \"\", \"\", \"\", \"\"]);\n    } catch (error: any) {\n      setErrorMsg(error.message || \"Failed to send verification code. Please try again.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Handle OTP input change\n  const handleOtpChange = (index: number, value: string) => {\n    if (!/^\\d?$/.test(value)) return;\n    const newDigits = [...otpDigits];\n    newDigits[index] = value;\n    setOtpDigits(newDigits);\n    setErrorMsg(\"\");\n    \n    if (value && index < 5) {\n      const nextInput = document.getElementById(`login-otp-${index + 1}`);\n      nextInput?.focus();\n    }\n  };\n\n  // Handle backspace\n  const handleOtpKeyDown = (index: number, e: React.KeyboardEvent) => {\n    if (e.key === 'Backspace' && !otpDigits[index] && index > 0) {\n      const prevInput = document.getElementById(`login-otp-${index - 1}`);\n      prevInput?.focus();\n    }\n    // Auto-submit when all digits entered and Enter pressed\n    if (e.key === 'Enter' && otpDigits.every(d => d !== '')) {\n      handleVerifyOTP();\n    }\n  };\n\n  // Handle paste\n  const handleOtpPaste = (e: React.ClipboardEvent) => {\n    e.preventDefault();\n    const pastedData = e.clipboardData.getData('text').replace(/\\D/g, '').slice(0, 6);\n    if (pastedData.length > 0) {\n      const newDigits = [...otpDigits];\n      for (let i = 0; i < 6; i++) {\n        newDigits[i] = pastedData[i] || '';\n      }\n      setOtpDigits(newDigits);\n      const focusIndex = Math.min(pastedData.length, 5);\n      const input = document.getElementById(`login-otp-${focusIndex}`);\n      input?.focus();\n    }\n  };\n\n  // Verify OTP code\n  const handleVerifyOTP = async () => {\n    setErrorMsg(\"\");\n    setSuccessMsg(\"\");\n\n    const otpCode = otpDigits.join(\"\");\n    if (otpCode.length !== 6) {\n      setErrorMsg(\"Please enter the complete 6-digit code\");\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const { data, error } = await supabase.auth.verifyOtp({\n        email: email,\n        token: otpCode,\n        type: 'email',\n      });\n\n      if (error) throw error;\n\n      if (data.user) {\n        // Save user to database\n        await saveUserToDatabase(data.user);\n\n        // Get user role and redirect\n        const userRole = data.user.user_metadata?.role?.toLowerCase();\n        \n        setSuccessMsg(\"Login successful! Redirecting...\");\n        \n        setTimeout(() => {\n          if (userRole === 'facility') {\n            navigate('/facility-dashboard', { replace: true });\n          } else if (userRole === 'physician' || userRole === 'crna') {\n            navigate('/physician-dashboard', { replace: true });\n          } else {\n            // User exists but no role - send to profile completion\n            navigate('/profile-completion', { replace: true });\n          }\n        }, 500);\n      }\n    } catch (error: any) {\n      if (error.message?.includes('expired')) {\n        setErrorMsg(\"Code has expired. Please request a new one.\");\n      } else if (error.message?.includes('Invalid') || error.message?.includes('invalid')) {\n        setErrorMsg(\"Invalid code. Please check and try again.\");\n      } else {\n        setErrorMsg(error.message || \"Verification failed. Please try again.\");\n      }\n      setOtpDigits([\"\", \"\", \"\", \"\", \"\", \"\"]);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Resend OTP\n  const handleResendOTP = async () => {\n    if (resendCooldown > 0) return;\n    \n    setErrorMsg(\"\");\n    setSuccessMsg(\"\");\n    setIsSubmitting(true);\n\n    try {\n      const { error } = await supabase.auth.signInWithOtp({\n        email: email,\n        options: {\n          shouldCreateUser: false,\n        }\n      });\n\n      if (error) throw error;\n\n      setSuccessMsg(\"A new code has been sent to your email\");\n      setResendCooldown(60);\n      setOtpDigits([\"\", \"\", \"\", \"\", \"\", \"\"]);\n    } catch (error: any) {\n      setErrorMsg(error.message || \"Failed to resend code. Please try again.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Go back to email step\n  const handleBackToEmail = () => {\n    setStep(\"email\");\n    setOtpDigits([\"\", \"\", \"\", \"\", \"\", \"\"]);\n    setErrorMsg(\"\");\n    setSuccessMsg(\"\");\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4 py-8\">\n      <div className=\"w-full max-w-md bg-white rounded-xl shadow-lg p-6\">\n        <h2 className=\"text-2xl font-bold text-gray-900 mb-2 text-center\">\n          {step === \"email\" ? \"Log In\" : \"Enter Verification Code\"}\n        </h2>\n        \n        {step === \"email\" ? (\n          <>\n            <p className=\"text-gray-600 text-sm text-center mb-6\">\n              Enter your email to receive a 6-digit verification code\n            </p>\n\n            {/* Google Sign In Button */}\n            <button\n              type=\"button\"\n              onClick={handleGoogleSignIn}\n              disabled={isGoogleLoading}\n              className=\"w-full flex items-center justify-center gap-3 py-2.5 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isGoogleLoading ? (\n                <i className=\"ri-loader-4-line animate-spin text-lg\"></i>\n              ) : (\n                <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n                  <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n                  <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n                  <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n                  <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n                </svg>\n              )}\n              <span className=\"font-medium text-gray-700\">\n                {isGoogleLoading ? \"Connecting...\" : \"Continue with Google\"}\n              </span>\n            </button>\n\n            {/* Divider */}\n            <div className=\"relative my-5\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t border-gray-200\"></div>\n              </div>\n              <div className=\"relative flex justify-center text-sm\">\n                <span className=\"px-3 bg-white text-gray-500\">or continue with email</span>\n              </div>\n            </div>\n\n            {/* Email Input */}\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Email Address\n              </label>\n              <input\n                type=\"email\"\n                value={email}\n                onChange={(e) => {\n                  setEmail(e.target.value);\n                  setErrorMsg(\"\");\n                }}\n                placeholder=\"you@example.com\"\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none text-sm\"\n                onKeyDown={(e) => e.key === 'Enter' && handleSendOTP()}\n              />\n            </div>\n\n            {/* Error message */}\n            {errorMsg && (\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-sm text-red-600\">{errorMsg}</p>\n              </div>\n            )}\n\n            {/* Send OTP Button */}\n            <button\n              type=\"button\"\n              onClick={handleSendOTP}\n              disabled={isSubmitting || !email.trim()}\n              className={`w-full py-2.5 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${\n                isSubmitting || !email.trim()\n                  ? \"bg-gray-400 cursor-not-allowed\"\n                  : \"bg-teal-600 hover:bg-teal-700\"\n              }`}\n            >\n              {isSubmitting ? (\n                <span className=\"flex items-center justify-center\">\n                  <i className=\"ri-loader-4-line animate-spin mr-2\"></i>Sending code...\n                </span>\n              ) : (\n                \"Send Verification Code\"\n              )}\n            </button>\n\n            {/* Links */}\n            <div className=\"flex justify-center mt-4 text-sm\">\n              <span className=\"text-gray-600\">Don&apos;t have an account?</span>\n              <a href=\"/signup\" className=\"text-teal-600 hover:underline whitespace-nowrap ml-1 cursor-pointer\">\n                Sign up\n              </a>\n            </div>\n          </>\n        ) : (\n          <>\n            <p className=\"text-gray-600 text-sm text-center mb-2\">\n              We sent a 6-digit code to\n            </p>\n            <p className=\"font-medium text-gray-900 text-center mb-6\">{email}</p>\n\n            {/* Success message */}\n            {successMsg && (\n              <div className=\"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg\">\n                <p className=\"text-sm text-green-600 flex items-center justify-center\">\n                  <i className=\"ri-checkbox-circle-line mr-2\"></i>\n                  {successMsg}\n                </p>\n              </div>\n            )}\n\n            {/* OTP Input - 6 separate boxes */}\n            <div className=\"flex justify-center gap-2 mb-6\" onPaste={handleOtpPaste}>\n              {otpDigits.map((digit, idx) => (\n                <input\n                  key={idx}\n                  id={`login-otp-${idx}`}\n                  type=\"text\"\n                  inputMode=\"numeric\"\n                  maxLength={1}\n                  value={digit}\n                  onChange={(e) => handleOtpChange(idx, e.target.value)}\n                  onKeyDown={(e) => handleOtpKeyDown(idx, e)}\n                  className=\"w-11 h-14 text-center border border-gray-300 rounded-lg text-2xl font-mono focus:outline-none focus:ring-2 focus:ring-teal-500\"\n                  autoFocus={idx === 0}\n                />\n              ))}\n            </div>\n\n            {/* Error message */}\n            {errorMsg && (\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-sm text-red-600\">{errorMsg}</p>\n              </div>\n            )}\n\n            {/* Verify Button */}\n            <button\n              type=\"button\"\n              onClick={handleVerifyOTP}\n              disabled={isSubmitting || otpDigits.some(d => d === '')}\n              className={`w-full py-2.5 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${\n                isSubmitting || otpDigits.some(d => d === '')\n                  ? \"bg-gray-400 cursor-not-allowed\"\n                  : \"bg-teal-600 hover:bg-teal-700\"\n              }`}\n            >\n              {isSubmitting ? (\n                <span className=\"flex items-center justify-center\">\n                  <i className=\"ri-loader-4-line animate-spin mr-2\"></i>Verifying...\n                </span>\n              ) : (\n                \"Verify & Log In\"\n              )}\n            </button>\n\n            {/* Resend & Back buttons */}\n            <div className=\"flex items-center justify-between mt-4\">\n              <button\n                type=\"button\"\n                onClick={handleBackToEmail}\n                className=\"text-sm text-gray-600 hover:text-gray-800 flex items-center cursor-pointer\"\n              >\n                <i className=\"ri-arrow-left-line mr-1\"></i>\n                Change email\n              </button>\n              \n              <button\n                type=\"button\"\n                onClick={handleResendOTP}\n                disabled={resendCooldown > 0 || isSubmitting}\n                className={`text-sm whitespace-nowrap cursor-pointer ${\n                  resendCooldown > 0 || isSubmitting\n                    ? \"text-gray-400 cursor-not-allowed\"\n                    : \"text-teal-600 hover:text-teal-700\"\n                }`}\n              >\n                {resendCooldown > 0 ? (\n                  `Resend in ${resendCooldown}s`\n                ) : (\n                  \"Resend code\"\n                )}\n              </button>\n            </div>\n\n            {/* Help text */}\n            <div className=\"mt-6 p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-xs text-gray-500 text-center\">\n                <i className=\"ri-information-line mr-1\"></i>\n                Check your inbox and spam folder for the verification code\n              </p>\n            </div>\n          </>\n        )}\n\n        {/* Security note */}\n        <div className=\"mt-6 pt-4 border-t border-gray-100\">\n          <p className=\"text-xs text-gray-500 text-center flex items-center justify-center\">\n            <i className=\"ri-shield-check-line mr-1 text-teal-600\"></i>\n            Secure passwordless authentication\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["LoginPage","navigate","useNavigate","step","setStep","useState","email","setEmail","otpDigits","setOtpDigits","isSubmitting","setIsSubmitting","errorMsg","setErrorMsg","successMsg","setSuccessMsg","resendCooldown","setResendCooldown","isGoogleLoading","setIsGoogleLoading","useEffect","hashParams","hasAccessToken","hasRefreshToken","resolve","session","error","supabase","saveUserToDatabase","userRole","timer","handleGoogleSignIn","user","err","handleSendOTP","emailValidation","validateEmail","handleOtpChange","index","value","newDigits","handleOtpKeyDown","e","d","handleVerifyOTP","handleOtpPaste","pastedData","i","focusIndex","otpCode","data","handleResendOTP","handleBackToEmail","jsxs","jsx","Fragment","digit","idx"],"mappings":"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"}