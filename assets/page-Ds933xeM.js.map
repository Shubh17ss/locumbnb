{"version":3,"file":"page-Ds933xeM.js","sources":["../../src/pages/signup/page.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"../../utils/supabaseClient\";\nimport { validateEmail, validatePhone, validatePassword, formatPhoneForSupabase } from \"../../utils/validation\";\n\ntype Role = \"physician\" | \"crna\" | \"facility\" | \"vendor\";\n\nexport default function SignUpPage() {\n  const navigate = useNavigate();\n\n  // Step handling (1 = role, 2 = details, 3 = OTP, 4 = confirmation)\n  const [step, setStep] = useState<number>(1);\n\n  // Common fields\n  const [role, setRole] = useState<Role | \"\">(\"\");\n  const [usePhone, setUsePhone] = useState<boolean>(false);\n  const [fullName, setFullName] = useState<string>(\"\");\n  const [contact, setContact] = useState<string>(\"\"); // email or phone\n  const [password, setPassword] = useState<string>(\"\");\n  const [showPassword, setShowPassword] = useState<boolean>(false);\n  const [termsAccepted, setTermsAccepted] = useState<boolean>(false);\n  const [consentAccepted, setConsentAccepted] = useState<boolean>(false);\n\n  // Validation errors\n  const [contactError, setContactError] = useState<string>(\"\");\n  const [passwordError, setPasswordError] = useState<string>(\"\");\n  const [generalError, setGeneralError] = useState<string>(\"\");\n\n  // OTP handling (6-digit)\n  const [otpDigits, setOtpDigits] = useState<string[]>([\"\", \"\", \"\", \"\", \"\", \"\"]);\n  const [resendTimer, setResendTimer] = useState<number>(60);\n  const [isVerifying, setIsVerifying] = useState<boolean>(false);\n  const [isSendingOtp, setIsSendingOtp] = useState<boolean>(false);\n  const [otpAttempts, setOtpAttempts] = useState<number>(0);\n  const [isGoogleLoading, setIsGoogleLoading] = useState<boolean>(false);\n\n  // Store pending user data for after verification\n  const pendingUserData = useRef<{\n    fullName: string;\n    role: string;\n    contact: string;\n    password: string;\n    usePhone: boolean;\n  } | null>(null);\n\n  // Handle OAuth callback redirect\n  useEffect(() => {\n    const handleOAuthCallback = async () => {\n      console.log('Checking for OAuth callback...', {\n        hash: window.location.hash,\n        search: window.location.search,\n        pathname: window.location.pathname\n      });\n\n      // Check if this is an OAuth callback from Supabase\n      // Method 1: Check URL hash for tokens (Supabase sometimes puts them there)\n      const hashParams = new URLSearchParams(window.location.hash.substring(1));\n      const hasAccessToken = hashParams.has('access_token');\n      const hasRefreshToken = hashParams.has('refresh_token');\n      \n      // Method 2: Check URL query params for role (our custom param)\n      const urlParams = new URLSearchParams(window.location.search);\n      const urlRole = urlParams.get('role') as Role | null;\n      \n      // Method 3: Check localStorage for pending role\n      const pendingRole = localStorage.getItem('pending_oauth_role') as Role | null;\n      \n      // Determine the role from any available source\n      const detectedRole = urlRole || pendingRole;\n      \n      console.log('OAuth detection:', {\n        hasAccessToken,\n        hasRefreshToken,\n        urlRole,\n        pendingRole,\n        detectedRole\n      });\n\n      // Check if we should process OAuth callback\n      const shouldProcessOAuth = (hasAccessToken || hasRefreshToken) || \n                                  (detectedRole && step === 1); // Has role and still on role selection step\n\n      if (shouldProcessOAuth && detectedRole) {\n        console.log('Processing OAuth callback for role:', detectedRole);\n        \n        try {\n          // Wait a moment for Supabase to process the tokens\n          await new Promise(resolve => setTimeout(resolve, 500));\n          \n          // Check for authenticated session\n          const { data: { session }, error } = await supabase.auth.getSession();\n          \n          console.log('Session check:', { hasSession: !!session, error });\n          \n          if (error) {\n            console.error('OAuth session error:', error);\n            setGeneralError('Authentication failed. Please try again.');\n            localStorage.removeItem('pending_oauth_role');\n            // Clean up URL\n            window.history.replaceState({}, document.title, '/signup');\n            return;\n          }\n\n          if (session?.user) {\n            console.log('User authenticated, updating profile...');\n            \n            // Update user metadata with role\n            await supabase.auth.updateUser({\n              data: { role: detectedRole }\n            });\n\n            // Save to database - FIXED ERROR HANDLING\n            const { error: upsertError } = await supabase.from('users').upsert({\n              id: session.user.id,\n              email: session.user.email,\n              full_name: session.user.user_metadata?.full_name || session.user.user_metadata?.name,\n              role: detectedRole,\n              updated_at: new Date().toISOString()\n            }, { onConflict: 'id' });\n\n            if (upsertError) {\n              console.error('Error saving user to database:', upsertError);\n            }\n\n            // Clear pending role\n            localStorage.removeItem('pending_oauth_role');\n\n            // Clean up URL\n            window.history.replaceState({}, document.title, window.location.pathname);\n\n            console.log('Redirecting to dashboard for role:', detectedRole);\n\n            // Redirect based on role\n            if (detectedRole === 'facility') {\n              navigate('/facility-dashboard', { replace: true });\n            } else if (detectedRole === 'physician' || detectedRole === 'crna' || detectedRole === 'vendor') {\n              navigate('/physician-dashboard', { replace: true });\n            } else {\n              navigate('/profile-completion', { replace: true });\n            }\n          } else {\n            console.log('No session found yet, will retry...');\n            // No session yet - might still be processing\n            setGeneralError('Please wait while we complete your sign in...');\n            // Retry after a moment\n            setTimeout(handleOAuthCallback, 1000);\n          }\n        } catch (error: any) {\n          console.error('OAuth processing error:', error);\n          setGeneralError('Authentication failed. Please try again.');\n          localStorage.removeItem('pending_oauth_role');\n          window.history.replaceState({}, document.title, '/signup');\n        }\n      }\n    };\n\n    handleOAuthCallback();\n  }, [navigate, step]);\n\n  // Google OAuth Sign In\n  const handleGoogleSignIn = async () => {\n    if (!role) {\n      setGeneralError(\"Please select a role first\");\n      return;\n    }\n\n    setIsGoogleLoading(true);\n    setGeneralError(\"\");\n\n    try {\n      // Store role in localStorage for after OAuth redirect\n      localStorage.setItem('pending_oauth_role', role);\n      console.log('Starting Google OAuth for role:', role);\n      \n      const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n          redirectTo: `${window.location.origin}/signup?role=${role}`,\n          queryParams: {\n            access_type: 'offline',\n            prompt: 'consent',\n          },\n        }\n      });\n\n      if (error) throw error;\n    } catch (error: any) {\n      console.error('Google OAuth error:', error);\n      setGeneralError(error.message || \"Failed to sign in with Google. Please try again.\");\n      setIsGoogleLoading(false);\n      localStorage.removeItem('pending_oauth_role');\n    }\n  };\n\n  // Send OTP via Supabase\n  const sendOtp = async () => {\n    setGeneralError(\"\");\n    setContactError(\"\");\n    setPasswordError(\"\");\n\n    // Validate contact\n    if (usePhone) {\n      const phoneValidation = validatePhone(contact);\n      if (!phoneValidation.valid) {\n        setContactError(phoneValidation.error || \"Invalid phone number\");\n        return;\n      }\n    } else {\n      const emailValidation = validateEmail(contact);\n      if (!emailValidation.valid) {\n        setContactError(emailValidation.error || \"Invalid email address. Please include @ and a valid domain.\");\n        return;\n      }\n    }\n\n    // Validate password\n    const passwordValidation = validatePassword(password);\n    if (!passwordValidation.valid) {\n      setPasswordError(passwordValidation.error || \"Invalid password\");\n      return;\n    }\n\n    setIsSendingOtp(true);\n\n    try {\n      // Store user data for after verification\n      pendingUserData.current = {\n        fullName,\n        role: role as string,\n        contact,\n        password,\n        usePhone\n      };\n\n      if (usePhone) {\n        // For phone, use signUp which sends SMS OTP\n        const formattedPhone = formatPhoneForSupabase(contact);\n        const { error } = await supabase.auth.signUp({\n          phone: formattedPhone,\n          password: password,\n          options: {\n            data: {\n              full_name: fullName,\n              role: role,\n            }\n          }\n        });\n\n        if (error) {\n          if (error.message?.toLowerCase().includes('phone') && \n              (error.message?.toLowerCase().includes('disabled') || \n               error.message?.toLowerCase().includes('not enabled'))) {\n            throw new Error('Phone authentication is not yet enabled. Please use email signup or contact support.');\n          }\n          throw error;\n        }\n      } else {\n        // For email signup with password + email confirmation code\n        const { error } = await supabase.auth.signUp({\n          email: contact,\n          password: password,\n          options: {\n            emailRedirectTo: undefined, // No magic link redirect\n            data: {\n              full_name: fullName,\n              role: role,\n            }\n          }\n        });\n\n        if (error) {\n          throw error;\n        }\n      }\n\n      setStep(3);\n      setResendTimer(60);\n      setOtpDigits([\"\", \"\", \"\", \"\", \"\", \"\"]);\n      setOtpAttempts(0);\n    } catch (error: any) {\n      if (error.message?.includes('already registered')) {\n        setGeneralError(\"This email is already registered. Please log in instead.\");\n      } else if (error.message?.includes('rate limit')) {\n        setGeneralError(\"Too many requests. Please wait a moment before trying again.\");\n      } else {\n        setGeneralError(error.message || \"Failed to send verification code. Please try again.\");\n      }\n    } finally {\n      setIsSendingOtp(false);\n    }\n  };\n\n  // Countdown for resend button\n  useEffect(() => {\n    if (step !== 3) return;\n    if (resendTimer === 0) return;\n    const id = setTimeout(() => setResendTimer((t) => t - 1), 1000);\n    return () => clearTimeout(id);\n  }, [resendTimer, step]);\n\n  // Handle OTP input change – auto-focus next field\n  const handleOtpChange = (index: number, value: string) => {\n    if (!/^\\d?$/.test(value)) return; // Only allow 0-9\n    const newDigits = [...otpDigits];\n    newDigits[index] = value;\n    setOtpDigits(newDigits);\n    if (value && index < 5) {\n      const nextInput = document.getElementById(`otp-${index + 1}`);\n      nextInput?.focus();\n    }\n  };\n\n  // Handle backspace to go to previous field\n  const handleOtpKeyDown = (index: number, e: React.KeyboardEvent) => {\n    if (e.key === 'Backspace' && !otpDigits[index] && index > 0) {\n      const prevInput = document.getElementById(`otp-${index - 1}`);\n      prevInput?.focus();\n    }\n  };\n\n  // Handle paste for OTP\n  const handleOtpPaste = (e: React.ClipboardEvent) => {\n    e.preventDefault();\n    const pastedData = e.clipboardData.getData('text').replace(/\\D/g, '').slice(0, 6);\n    if (pastedData.length > 0) {\n      const newDigits = [...otpDigits];\n      for (let i = 0; i < 6; i++) {\n        newDigits[i] = pastedData[i] || '';\n      }\n      setOtpDigits(newDigits);\n      // Focus the last filled input or the next empty one\n      const focusIndex = Math.min(pastedData.length, 5);\n      const input = document.getElementById(`otp-${focusIndex}`);\n      input?.focus();\n    }\n  };\n\n  const verifyOtp = async () => {\n    if (otpDigits.some((d) => d === \"\")) {\n      setGeneralError(\"Please enter the complete 6-digit code.\");\n      return;\n    }\n    \n    setIsVerifying(true);\n    setGeneralError(\"\");\n\n    try {\n      const otpCode = otpDigits.join(\"\");\n      const userData = pendingUserData.current;\n\n      if (!userData) {\n        throw new Error(\"Session expired. Please start over.\");\n      }\n\n      if (usePhone) {\n        const formattedPhone = formatPhoneForSupabase(userData.contact);\n        const { data, error } = await supabase.auth.verifyOtp({\n          phone: formattedPhone,\n          token: otpCode,\n          type: 'sms'\n        });\n\n        if (error) throw error;\n\n        // Save user data to users table - FIXED ERROR HANDLING\n        if (data.user) {\n          const { error: upsertError } = await supabase.from('users').upsert({\n            id: data.user.id,\n            phone: formattedPhone,\n            full_name: userData.fullName,\n            role: userData.role,\n            phone_verified: true,\n            profile_complete: false,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          }, { onConflict: 'id' });\n\n          if (upsertError) {\n            console.error('Error saving user to database:', upsertError);\n          }\n        }\n      } else {\n        // Verify email confirmation code (signup type)\n        const { data, error } = await supabase.auth.verifyOtp({\n          email: userData.contact,\n          token: otpCode,\n          type: 'signup'\n        });\n\n        if (error) throw error;\n\n        // Save user data to users table - FIXED ERROR HANDLING\n        if (data.user) {\n          const { error: upsertError } = await supabase.from('users').upsert({\n            id: data.user.id,\n            email: userData.contact,\n            full_name: userData.fullName,\n            role: userData.role,\n            email_verified: true,\n            profile_complete: false,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          }, { onConflict: 'id' });\n\n          if (upsertError) {\n            console.error('Error saving user to database:', upsertError);\n          }\n        }\n      }\n\n      // Clear pending data\n      pendingUserData.current = null;\n      setStep(4); // Move to confirmation screen\n    } catch (error: any) {\n      setOtpAttempts(prev => prev + 1);\n      \n      if (otpAttempts >= 2) {\n        setGeneralError(\"Too many incorrect attempts. Please request a new code.\");\n      } else if (error.message?.includes('expired')) {\n        setGeneralError(\"Verification code has expired. Please request a new code.\");\n      } else if (error.message?.includes('Invalid') || error.message?.includes('invalid')) {\n        setGeneralError(\"Invalid verification code. Please check the code and try again.\");\n      } else {\n        setGeneralError(error.message || \"Verification failed. Please try again.\");\n      }\n      setOtpDigits([\"\", \"\", \"\", \"\", \"\", \"\"]);\n    } finally {\n      setIsVerifying(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4 py-8\">\n      <div className=\"w-full max-w-md bg-white rounded-xl shadow-lg p-6\">\n        {/* STEP 1 – ROLE SELECTION */}\n        {step === 1 && (\n          <>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-4 text-center\">\n              Who are you?\n            </h2>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <RoleCard\n                value=\"physician\"\n                label=\"Physician\"\n                description=\"Licensed medical doctor\"\n                role={role}\n                setRole={setRole}\n              />\n              <RoleCard\n                value=\"crna\"\n                label=\"CRNA / Advanced Provider\"\n                description=\"Certified Registered Nurse Anesthetist\"\n                role={role}\n                setRole={setRole}\n              />\n              <RoleCard\n                value=\"facility\"\n                label=\"Facility\"\n                description=\"Hospital or clinic\"\n                role={role}\n                setRole={setRole}\n              />\n              <RoleCard\n                value=\"vendor\"\n                label=\"Third-Party Vendor\"\n                description=\"Service provider\"\n                role={role}\n                setRole={setRole}\n              />\n            </div>\n            <button\n              type=\"button\"\n              onClick={() => setStep(2)}\n              disabled={!role}\n              className={`mt-6 w-full py-2 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${\n                role\n                  ? \"bg-teal-600 hover:bg-teal-700\"\n                  : \"bg-gray-300 text-gray-500 cursor-not-allowed\"\n              }`}\n            >\n              Continue\n            </button>\n          </>\n        )}\n\n        {/* STEP 2 – DETAILS & CONSENT */}\n        {step === 2 && (\n          <>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-4 text-center\">\n              Create your account\n            </h2>\n\n            {/* Google Sign In Button */}\n            <button\n              type=\"button\"\n              onClick={handleGoogleSignIn}\n              disabled={isGoogleLoading}\n              className=\"w-full flex items-center justify-center gap-3 py-2.5 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isGoogleLoading ? (\n                <i className=\"ri-loader-4-line animate-spin text-lg\"></i>\n              ) : (\n                <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n                  <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n                  <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n                  <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n                  <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n                </svg>\n              )}\n              <span className=\"font-medium text-gray-700\">\n                {isGoogleLoading ? \"Connecting...\" : \"Continue with Google\"}\n              </span>\n            </button>\n\n            {/* Divider */}\n            <div className=\"relative my-5\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t border-gray-200\"></div>\n              </div>\n              <div className=\"relative flex justify-center text-sm\">\n                <span className=\"px-3 bg-white text-gray-500\">or sign up with email</span>\n              </div>\n            </div>\n\n            {/* Toggle Email / Phone */}\n            <div className=\"flex items-center justify-center gap-4 mb-4\">\n              <button\n                type=\"button\"\n                onClick={() => setUsePhone(false)}\n                className={`px-3 py-1 rounded whitespace-nowrap cursor-pointer ${\n                  !usePhone ? \"bg-teal-600 text-white\" : \"bg-gray-100 text-gray-700\"\n                }`}\n              >\n                Email\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setUsePhone(true)}\n                className={`px-3 py-1 rounded whitespace-nowrap cursor-pointer ${\n                  usePhone ? \"bg-teal-600 text-white\" : \"bg-gray-100 text-gray-700\"\n                }`}\n              >\n                Phone\n              </button>\n            </div>\n\n            {/* Full Name / DBA */}\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Full Name / DBA\n              </label>\n              <input\n                type=\"text\"\n                value={fullName}\n                onChange={(e) => setFullName(e.target.value)}\n                placeholder=\"John Doe or Acme Clinic\"\n                className=\"mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none text-sm\"\n              />\n            </div>\n\n            {/* Email / Phone Input */}\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                {usePhone ? \"Phone Number\" : \"Email Address\"}\n              </label>\n              <input\n                type={usePhone ? \"tel\" : \"email\"}\n                value={contact}\n                onChange={(e) => {\n                  setContact(e.target.value);\n                  setContactError(\"\");\n                }}\n                placeholder={usePhone ? \"+1 555-123-4567\" : \"you@example.com\"}\n                className={`mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none text-sm ${\n                  contactError ? \"border-red-500\" : \"border-gray-300\"\n                }`}\n              />\n              {contactError && (\n                <p className=\"mt-1 text-xs text-red-600\">{contactError}</p>\n              )}\n            </div>\n\n            {/* Password Input */}\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Password\n              </label>\n              <div className=\"relative\">\n                <input\n                  type={showPassword ? \"text\" : \"password\"}\n                  value={password}\n                  onChange={(e) => {\n                    setPassword(e.target.value);\n                    setPasswordError(\"\");\n                  }}\n                  placeholder=\"Create a strong password\"\n                  className={`mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none text-sm ${\n                    passwordError ? \"border-red-500\" : \"border-gray-300\"\n                  }`}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 cursor-pointer\"\n                >\n                  <i className={showPassword ? \"ri-eye-off-line\" : \"ri-eye-line\"}></i>\n                </button>\n              </div>\n              {passwordError && (\n                <p className=\"mt-1 text-xs text-red-600\">{passwordError}</p>\n              )}\n              <p className=\"mt-1 text-xs text-gray-500\">\n                Must be 8+ characters with uppercase, lowercase, number, and special character\n              </p>\n            </div>\n\n            {/* Role-specific consent */}\n            <div className=\"mb-4 flex items-start\">\n              <input\n                type=\"checkbox\"\n                id=\"role-consent\"\n                checked={consentAccepted}\n                onChange={(e) => setConsentAccepted(e.target.checked)}\n                className=\"mt-1 h-4 w-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500 cursor-pointer\"\n              />\n              <label htmlFor=\"role-consent\" className=\"ml-2 text-sm text-gray-700 cursor-pointer\">\n                {role ? ConsentText[role as Role] : \"I accept the role-specific consent.\"}\n              </label>\n            </div>\n\n            {/* Terms & Conditions */}\n            <div className=\"mb-4 flex items-start\">\n              <input\n                type=\"checkbox\"\n                id=\"terms\"\n                checked={termsAccepted}\n                onChange={(e) => setTermsAccepted(e.target.checked)}\n                className=\"mt-1 h-4 w-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500 cursor-pointer\"\n              />\n              <label htmlFor=\"terms\" className=\"ml-2 text-sm text-gray-700 cursor-pointer\">\n                I agree to the <a href=\"/terms\" className=\"text-teal-600 underline\">Terms of Service</a> and{\" \"}\n                <a href=\"/privacy\" className=\"text-teal-600 underline\">Privacy Policy</a>.\n              </label>\n            </div>\n\n            {/* General Error */}\n            {generalError && (\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-sm text-red-600\">{generalError}</p>\n              </div>\n            )}\n\n            {/* Action Buttons */}\n            <div className=\"flex justify-between\">\n              <button\n                type=\"button\"\n                onClick={() => setStep(1)}\n                className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 whitespace-nowrap cursor-pointer\"\n              >\n                ← Back\n              </button>\n              <button\n                type=\"button\"\n                onClick={sendOtp}\n                disabled={\n                  !fullName.trim() ||\n                  !contact.trim() ||\n                  !password.trim() ||\n                  !consentAccepted ||\n                  !termsAccepted ||\n                  isSendingOtp\n                }\n                className={`px-4 py-2 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${\n                  fullName.trim() &&\n                  contact.trim() &&\n                  password.trim() &&\n                  consentAccepted &&\n                  termsAccepted &&\n                  !isSendingOtp\n                    ? \"bg-teal-600 hover:bg-teal-700\"\n                    : \"bg-gray-300 text-gray-500 cursor-not-allowed\"\n                }`}\n              >\n                {isSendingOtp ? (\n                  <span className=\"flex items-center\">\n                    <i className=\"ri-loader-4-line animate-spin mr-2\"></i>Sending...\n                  </span>\n                ) : (\n                  \"Send Verification Code\"\n                )}\n              </button>\n            </div>\n          </>\n        )}\n\n        {/* STEP 3 – OTP VERIFICATION */}\n        {step === 3 && (\n          <>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-4 text-center\">\n              Enter Verification Code\n            </h2>\n\n            <p className=\"text-sm text-gray-600 mb-4 text-center\">\n              We sent a 6-digit code to <strong>{contact}</strong>\n            </p>\n\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4\">\n              <p className=\"text-xs text-amber-800 text-center\">\n                <i className=\"ri-information-line mr-1\"></i>\n                Check your {usePhone ? \"SMS messages\" : \"email inbox (and spam folder)\"} for the 6-digit code\n              </p>\n            </div>\n\n            <div className=\"flex justify-center gap-2 mb-6\" onPaste={handleOtpPaste}>\n              {otpDigits.map((digit, idx) => (\n                <input\n                  key={idx}\n                  id={`otp-${idx}`}\n                  type=\"text\"\n                  inputMode=\"numeric\"\n                  maxLength={1}\n                  value={digit}\n                  onChange={(e) => handleOtpChange(idx, e.target.value)}\n                  onKeyDown={(e) => handleOtpKeyDown(idx, e)}\n                  className=\"w-10 h-12 text-center border border-gray-300 rounded-lg text-xl focus:outline-none focus:ring-2 focus:ring-teal-500\"\n                  autoFocus={idx === 0}\n                />\n              ))}\n            </div>\n\n            {/* General Error */}\n            {generalError && (\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-sm text-red-600\">{generalError}</p>\n              </div>\n            )}\n\n            <div className=\"flex justify-between items-center mb-4\">\n              <button\n                type=\"button\"\n                onClick={sendOtp}\n                disabled={resendTimer > 0 || isSendingOtp}\n                className={`px-3 py-1 text-sm rounded whitespace-nowrap cursor-pointer ${\n                  resendTimer === 0 && !isSendingOtp\n                    ? \"bg-teal-600 text-white hover:bg-teal-700\"\n                    : \"bg-gray-200 text-gray-500 cursor-not-allowed\"\n                }`}\n              >\n                {isSendingOtp ? \"Sending...\" : resendTimer === 0 ? \"Resend Code\" : `Resend in ${resendTimer}s`}\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={verifyOtp}\n                disabled={otpDigits.some((d) => d === \"\") || isVerifying}\n                className={`px-4 py-2 rounded-lg text-white font-medium transition-colors whitespace-nowrap cursor-pointer ${\n                  otpDigits.every((d) => d !== \"\") && !isVerifying\n                    ? \"bg-teal-600 hover:bg-teal-700\"\n                    : \"bg-gray-300 text-gray-500 cursor-not-allowed\"\n                }`}\n              >\n                {isVerifying ? (\n                  <span className=\"flex items-center\">\n                    <i className=\"ri-loader-4-line animate-spin mr-2\"></i>Verifying...\n                  </span>\n                ) : (\n                  \"Verify & Create Account\"\n                )}\n              </button>\n            </div>\n\n            <button\n              type=\"button\"\n              onClick={() => setStep(2)}\n              className=\"w-full text-sm text-gray-600 hover:underline whitespace-nowrap cursor-pointer\"\n            >\n              ← Change contact info\n            </button>\n          </>\n        )}\n\n        {/* STEP 4 – CONFIRMATION */}\n        {step === 4 && (\n          <>\n            <div className=\"text-center\">\n              <div className=\"w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <i className=\"ri-check-line text-3xl text-teal-600\"></i>\n              </div>\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Account Created!\n              </h2>\n              <p className=\"text-sm text-gray-600 mb-6\">\n                Your account is now active. Complete your profile to start using the platform.\n              </p>\n\n              <div className=\"flex flex-col gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => navigate(\"/profile-completion\")}\n                  className=\"w-full py-2 rounded-lg bg-teal-600 text-white font-medium hover:bg-teal-700 transition-colors whitespace-nowrap cursor-pointer\"\n                >\n                  Complete Profile Now\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    const userData = pendingUserData.current;\n                    const userRole = userData?.role?.toLowerCase() || role;\n                    if (userRole === 'facility') {\n                      navigate('/facility-dashboard');\n                    } else {\n                      navigate('/physician-dashboard');\n                    }\n                  }}\n                  className=\"w-full py-2 rounded-lg bg-gray-100 text-gray-800 hover:bg-gray-200 transition-colors whitespace-nowrap cursor-pointer\"\n                >\n                  Go to Dashboard\n                </button>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Role Card Component\nfunction RoleCard({\n  value,\n  label,\n  description,\n  role,\n  setRole,\n}: {\n  value: Role;\n  label: string;\n  description: string;\n  role: Role | \"\";\n  setRole: (role: Role) => void;\n}) {\n  return (\n    <button\n      type=\"button\"\n      onClick={() => setRole(value)}\n      className={`flex flex-col items-center p-4 border rounded-lg transition-colors cursor-pointer ${\n        role === value ? \"border-teal-600 bg-teal-50\" : \"border-gray-300 hover:border-teal-400\"\n      }`}\n    >\n      <span className=\"text-lg font-semibold text-gray-800\">{label}</span>\n      <span className=\"text-sm text-gray-600 mt-1 text-center\">{description}</span>\n    </button>\n  );\n}\n\nconst ConsentText: Record<Role, string> = {\n  physician: \"I acknowledge that this platform is a technology marketplace only and I will be acting as an independent physician.\",\n  crna: \"I acknowledge that this platform is a technology marketplace only and I will be acting as an independent CRNA / advanced provider.\",\n  facility: \"I acknowledge that this platform is a technology marketplace only and I will be representing a healthcare facility.\",\n  vendor: \"I acknowledge that this platform is a technology marketplace only and I will be offering third-party services.\",\n};\n"],"names":["SignUpPage","navigate","useNavigate","step","setStep","useState","role","setRole","usePhone","setUsePhone","fullName","setFullName","contact","setContact","password","setPassword","showPassword","setShowPassword","termsAccepted","setTermsAccepted","consentAccepted","setConsentAccepted","contactError","setContactError","passwordError","setPasswordError","generalError","setGeneralError","otpDigits","setOtpDigits","resendTimer","setResendTimer","isVerifying","setIsVerifying","isSendingOtp","setIsSendingOtp","otpAttempts","setOtpAttempts","isGoogleLoading","setIsGoogleLoading","pendingUserData","useRef","useEffect","handleOAuthCallback","hashParams","hasAccessToken","hasRefreshToken","urlRole","pendingRole","detectedRole","resolve","session","error","supabase","upsertError","handleGoogleSignIn","sendOtp","phoneValidation","validatePhone","emailValidation","validateEmail","passwordValidation","validatePassword","formattedPhone","formatPhoneForSupabase","id","t","handleOtpChange","index","value","newDigits","handleOtpKeyDown","e","handleOtpPaste","pastedData","i","focusIndex","verifyOtp","d","otpCode","userData","data","prev","jsxs","Fragment","jsx","RoleCard","ConsentText","digit","idx","userRole","label","description"],"mappings":"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"}