{"version":3,"file":"adminAuditLogger-DDwDAuyc.js","sources":["../../src/utils/adminPermissions.ts","../../src/utils/adminAuditLogger.ts"],"sourcesContent":["import { AdminRole, AdminPermissions } from '../types/admin';\n\nexport const ROLE_PERMISSIONS: Record<AdminRole, AdminPermissions> = {\n  super: {\n    canViewUsers: true,\n    canModifyUsers: true,\n    canSuspendUsers: true,\n    canVerifyUsers: true,\n    canViewFinancials: true,\n    canModifyPayments: true,\n    canHoldPayments: true,\n    canReleasePayments: true,\n    canViewDisputes: true,\n    canResolveDisputes: true,\n    canEscalateDisputes: true,\n    canViewContracts: true,\n    canEnforcePolicy: true,\n    canApplyPenalties: true,\n    canManageVendors: true,\n    canViewVendorData: true,\n    canModerateContent: true,\n    canRemoveContent: true,\n    canViewAnalytics: true,\n    canExportData: true,\n    canManageAdmins: true,\n    canViewAuditLogs: true,\n    hasFullOverride: true,\n  },\n  operations_manager: {\n    canViewUsers: true,\n    canModifyUsers: true,\n    canSuspendUsers: false,\n    canVerifyUsers: true,\n    canViewFinancials: true,\n    canModifyPayments: false,\n    canHoldPayments: false,\n    canReleasePayments: false,\n    canViewDisputes: true,\n    canResolveDisputes: false,\n    canEscalateDisputes: true,\n    canViewContracts: true,\n    canEnforcePolicy: false,\n    canApplyPenalties: false,\n    canManageVendors: true,\n    canViewVendorData: true,\n    canModerateContent: true,\n    canRemoveContent: false,\n    canViewAnalytics: true,\n    canExportData: true,\n    canManageAdmins: false,\n    canViewAuditLogs: true,\n    hasFullOverride: false,\n  },\n  compliance_manager: {\n    canViewUsers: true,\n    canModifyUsers: false,\n    canSuspendUsers: true,\n    canVerifyUsers: true,\n    canViewFinancials: false,\n    canModifyPayments: false,\n    canHoldPayments: false,\n    canReleasePayments: false,\n    canViewDisputes: true,\n    canResolveDisputes: true,\n    canEscalateDisputes: true,\n    canViewContracts: true,\n    canEnforcePolicy: true,\n    canApplyPenalties: true,\n    canManageVendors: false,\n    canViewVendorData: false,\n    canModerateContent: true,\n    canRemoveContent: true,\n    canViewAnalytics: true,\n    canExportData: true,\n    canManageAdmins: false,\n    canViewAuditLogs: true,\n    hasFullOverride: false,\n  },\n  finance_manager: {\n    canViewUsers: true,\n    canModifyUsers: false,\n    canSuspendUsers: false,\n    canVerifyUsers: false,\n    canViewFinancials: true,\n    canModifyPayments: true,\n    canHoldPayments: true,\n    canReleasePayments: true,\n    canViewDisputes: true,\n    canResolveDisputes: true,\n    canEscalateDisputes: false,\n    canViewContracts: true,\n    canEnforcePolicy: false,\n    canApplyPenalties: false,\n    canManageVendors: false,\n    canViewVendorData: false,\n    canModerateContent: false,\n    canRemoveContent: false,\n    canViewAnalytics: true,\n    canExportData: true,\n    canManageAdmins: false,\n    canViewAuditLogs: true,\n    hasFullOverride: false,\n  },\n  support_agent: {\n    canViewUsers: true,\n    canModifyUsers: false,\n    canSuspendUsers: false,\n    canVerifyUsers: false,\n    canViewFinancials: false,\n    canModifyPayments: false,\n    canHoldPayments: false,\n    canReleasePayments: false,\n    canViewDisputes: true,\n    canResolveDisputes: false,\n    canEscalateDisputes: false,\n    canViewContracts: true,\n    canEnforcePolicy: false,\n    canApplyPenalties: false,\n    canManageVendors: false,\n    canViewVendorData: false,\n    canModerateContent: false,\n    canRemoveContent: false,\n    canViewAnalytics: false,\n    canExportData: false,\n    canManageAdmins: false,\n    canViewAuditLogs: false,\n    hasFullOverride: false,\n  },\n};\n\nexport const getRolePermissions = (role: AdminRole): AdminPermissions => {\n  return ROLE_PERMISSIONS[role];\n};\n\nexport const hasPermission = (\n  role: AdminRole,\n  permission: keyof AdminPermissions\n): boolean => {\n  return ROLE_PERMISSIONS[role][permission];\n};\n\nexport const ROLE_LABELS: Record<AdminRole, string> = {\n  super: 'super',\n  operations_manager: 'Operations Manager',\n  compliance_manager: 'Compliance Manager',\n  finance_manager: 'Finance Manager',\n  support_agent: 'Support Agent',\n};\n\nexport const ROLE_DESCRIPTIONS: Record<AdminRole, string> = {\n  super: 'Full platform access with override authority (limited to 3 users)',\n  operations_manager: 'Workflow monitoring, assignment oversight, vendor operations',\n  compliance_manager: 'Credential verification, contract enforcement, policy violations',\n  finance_manager: 'Escrow monitoring, payment flows, fee collection',\n  support_agent: 'View-only access, ticket responses (limited permissions)',\n};\n","import { AdminAuditLog } from '../types/admin';\n\nclass AdminAuditLogger {\n  private logs: AdminAuditLog[] = [];\n\n  log(\n    adminId: string,\n    adminEmail: string,\n    adminRole: string,\n    action: string,\n    entityType: string,\n    entityId: string,\n    details: Record<string, any>,\n    sessionId: string\n  ): void {\n    const auditLog: AdminAuditLog = {\n      id: `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      timestamp: new Date().toISOString(),\n      adminId,\n      adminEmail,\n      adminRole: adminRole as any,\n      action,\n      entityType,\n      entityId,\n      details,\n      ipAddress: this.getClientIP(),\n      deviceInfo: this.getDeviceInfo(),\n      sessionId,\n    };\n\n    this.logs.push(auditLog);\n    \n    // Store in localStorage for persistence (in production, this would go to a database)\n    this.persistLog(auditLog);\n    \n    console.log('[ADMIN AUDIT]', auditLog);\n  }\n\n  private persistLog(log: AdminAuditLog): void {\n    try {\n      const existingLogs = localStorage.getItem('admin_audit_logs');\n      const logs = existingLogs ? JSON.parse(existingLogs) : [];\n      logs.push(log);\n      \n      // Keep only last 1000 logs in localStorage\n      if (logs.length > 1000) {\n        logs.shift();\n      }\n      \n      localStorage.setItem('admin_audit_logs', JSON.stringify(logs));\n    } catch (error) {\n      console.error('Failed to persist audit log:', error);\n    }\n  }\n\n  getLogs(filters?: {\n    adminId?: string;\n    action?: string;\n    entityType?: string;\n    startDate?: string;\n    endDate?: string;\n  }): AdminAuditLog[] {\n    try {\n      const storedLogs = localStorage.getItem('admin_audit_logs');\n      let logs = storedLogs ? JSON.parse(storedLogs) : [];\n\n      if (filters) {\n        if (filters.adminId) {\n          logs = logs.filter((log: AdminAuditLog) => log.adminId === filters.adminId);\n        }\n        if (filters.action) {\n          logs = logs.filter((log: AdminAuditLog) => log.action === filters.action);\n        }\n        if (filters.entityType) {\n          logs = logs.filter((log: AdminAuditLog) => log.entityType === filters.entityType);\n        }\n        if (filters.startDate) {\n          logs = logs.filter((log: AdminAuditLog) => log.timestamp >= filters.startDate!);\n        }\n        if (filters.endDate) {\n          logs = logs.filter((log: AdminAuditLog) => log.timestamp <= filters.endDate!);\n        }\n      }\n\n      return logs.sort((a: AdminAuditLog, b: AdminAuditLog) => \n        new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\n      );\n    } catch (error) {\n      console.error('Failed to retrieve audit logs:', error);\n      return [];\n    }\n  }\n\n  private getClientIP(): string {\n    // In production, this would be captured server-side\n    return 'Client IP (captured server-side)';\n  }\n\n  private getDeviceInfo(): string {\n    const ua = navigator.userAgent;\n    const browser = this.getBrowserInfo(ua);\n    const os = this.getOSInfo(ua);\n    return `${browser} on ${os}`;\n  }\n\n  private getBrowserInfo(ua: string): string {\n    if (ua.includes('Chrome')) return 'Chrome';\n    if (ua.includes('Firefox')) return 'Firefox';\n    if (ua.includes('Safari')) return 'Safari';\n    if (ua.includes('Edge')) return 'Edge';\n    return 'Unknown Browser';\n  }\n\n  private getOSInfo(ua: string): string {\n    if (ua.includes('Windows')) return 'Windows';\n    if (ua.includes('Mac')) return 'macOS';\n    if (ua.includes('Linux')) return 'Linux';\n    if (ua.includes('Android')) return 'Android';\n    if (ua.includes('iOS')) return 'iOS';\n    return 'Unknown OS';\n  }\n\n  exportLogs(format: 'json' | 'csv' = 'json'): string {\n    const logs = this.getLogs();\n    \n    if (format === 'csv') {\n      const headers = ['Timestamp', 'Admin Email', 'Role', 'Action', 'Entity Type', 'Entity ID', 'IP Address', 'Device'];\n      const rows = logs.map(log => [\n        log.timestamp,\n        log.adminEmail,\n        log.adminRole,\n        log.action,\n        log.entityType,\n        log.entityId,\n        log.ipAddress,\n        log.deviceInfo,\n      ]);\n      \n      return [headers, ...rows].map(row => row.join(',')).join('\\n');\n    }\n    \n    return JSON.stringify(logs, null, 2);\n  }\n}\n\nexport const adminAuditLogger = new AdminAuditLogger();\n"],"names":["ROLE_PERMISSIONS","getRolePermissions","role","ROLE_LABELS","ROLE_DESCRIPTIONS","AdminAuditLogger","adminId","adminEmail","adminRole","action","entityType","entityId","details","sessionId","auditLog","log","existingLogs","logs","error","filters","storedLogs","a","b","ua","browser","os","format","headers","rows","row","adminAuditLogger"],"mappings":"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"}